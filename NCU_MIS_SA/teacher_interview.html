<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>老師面試管理</title>
    
    <link rel="stylesheet" type="text/css" href="statics/css/teacher_interview.css">
    <script src="statics/js/jquery-3.4.1.min.js" crossorigin="anonymous"></script>
</head>


<body>

    <div id="container">

        <div id="header">
            <div class="imgHolder"><a href="index.html"><img src="statics/img/Logo.png" alt="Logo"></a></div>
           	<h1> 老師面試管理</h1>
           	<label id="teacher_name"></label>
        </div>

        <div id="content">	
        
		<div id="Sidebar">
    			<p></p>
    			<div class="list"> 老師會員中心</div>
   					<div class="list">
        					<ul> <!--修改名稱與連結 Chu 12/25 8:27pm-->
            					<li><a href="teacher_edit.html">修改老師會員資料</a></li>
            					<li><a href="teacher_interview.html">面試管理</a></li>
            					<li><a href="teacher_match.html">成交紀錄</a></li>
        					</ul>
    				</div>
		</div>        			

<!--         
                <div id=Inquire class="btn-group-vertical">
                        <input class="btn btn-default" type="button" value="修改老師會員資訊" onclick="location.href='teacher_edit.html'" style="width:150px;height:50px;">
                        <input class="btn btn-default" type="button" value="面試管理" onclick="location.href='teacher_interview.html'" style="width:150px;height:50px;">
                        <input class="btn btn-default" type="button" value="成交紀錄" onclick="location.href='teacher_match.html'" style="width:150px;height:50px;">
                </div>
 -->
			<div id=Body>
            	<section id="case" >
                	<table id="interview_list">
                	<thead>
                         	<tr>
                           		<th>案件編號</th>
                        	    <th>家長會員手機</th>
                           	 	<th>上課科目</th>
                            	<th>上課地點</th>
                            	<th>管理狀態</th>
                        	</tr>
                 	</thead>
                 	<tbody>
                	</tbody>
                	</table>
            	</section>	
         	</div>   
        </div>        
    </div>
    <div id="Footer">®安心168家教網 created by 2019</div>
    
    <script type="text/javascript">
	    $(document).ready(function() {
	        //看登入
	        getLogin();
	    });
	    
	    var states = ['面試','成功','失敗'];
        
        function getInterview(){
        	
        	$.ajax({
                type: "GET",
                url: "api/interview.do",
                data: "teacher_id="+loginTID,
                crossDomain: true,
                cache: false,
                dataType: 'json',
                timeout: 5000,
                success: function (response) {
                    if(response.status == 200){
                  	  updateTable(response.response.data);
                    }
                    console.log(response);
                },
                error: function () {
                    alert("無法連線到伺服器！");
                }
          });
        }
        
     	//更新表格
        function updateTable(data) {	//做出html要的表單形式
            $("#interview_list > tbody").empty();
            var table_html = '';
            $.each(data, function(index, value) {	//data為陣列
            	table_html += '<tr><td scope="row">'+ '<a href="case_detail.html?id=' + value['case_id'] + '">' + value['case_id'] + '</a></td>';
                    table_html += '<td>' + value['Pphone'] + '</td>';
                    table_html += '<td>' + value['subject'] + '</td>';
                    table_html += '<td>' + value['teachCounty']+ value['teachRegion'] + '</td>';
                    table_html += '<td>' + states[value['state']] + '</td></tr>';
            })

            $("#interview_list > tbody").append(table_html);
        }
        
        //預設都是0，如果有人登入會去改，若其他部分又去取東西再用這個
        var loginTID=0;
        var loginEmail;
    	
        function getLogin(){
    		$.ajax({
    			type: "GET",
    			url: "api/login.do",
    			crossDomain: true,
    			cache: false,
    			dataType: 'json',
    			timeout: 5000,
    			success: function (response) {
    				if(response.status == 200){
    					if(response['response']['memberType']!="teacher"){
    						noTLogin();
    					}
    					else{
    						updateLogIn(response);
    						getInterview();
    					}
    				}
    				else{	//沒有登入
    					noTLogin();
    				}
    				console.log(response);
    			},
    			error: function () {
    				alert("無法連線到伺服器！");
    			}
    		});
    	}
    	
    	//更新顯示登入會員的地方
    	function updateLogIn(response){
    		$("#teacher_name").empty();
          	var label_html = "";
          	var name = response['response']['name'];
          	var typeStr = "老師";
          	//alert(type);
          	
          	loginTID = response['response']['id'];
          	//alert("loginTID: "+loginTID);
          	
          	label_html += '<label> '+ name + typeStr +'，您好</label>';
          	label_html += '<button id="logoutBtn">登出</button>';
          	$("#teacher_name").append(label_html);
          	var $form = $('#logoutBtn');
    		$form.click(function(){
    			logout();
    		});
        }
    	
    	//登出
    	function logout(){
    		$.ajax({
    			type: "DELETE",
    			url: "api/login.do",
    			cache: false,
    			dataType: 'json',
    			timeout: 5000,
    			success: function (response) {
    				//如果你們前端登入成功要新跳視窗出來就打在這
    				if (response.status == 200) {
    					loginPID=0;
    					loginTID=0;
    					alert(response.message);
    					noTLogin();
    				}
    			},
    			error: function () {
    				alert("無法連線到伺服器！");
    			}
    		});
    	}
    	
    	//沒會員登入的長相
    	function noTLogin(){
    		alert("未登入老師會員，將跳轉至首頁!");
    		window.location.assign("http://localhost:8090/NCU_MIS_SA_Group16/");
    	}
        
    </script>


</body>
</html>