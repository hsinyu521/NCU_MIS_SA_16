<!DOCTYPE HTML>
<!--
	Strongly Typed by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
  <title>家長會員註冊</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="assets/css/main.css" />
</head>
<body class="no-sidebar is-preload">
<div id="page-wrapper">

  <!-- Header -->
  <section id="header">
    <div class="container">

      <!-- Logo -->
      <h1 id="logo"><a href="index.html">Tutor 168</a></h1>
      <p>A best website finding your personal teacher!</p>
      <!-- Nav -->
      <nav id="nav">
        <ul>
          <li><a class="icon solid fa-home" href="index.html"><span>首頁</span></a></li>
          <li><a class="icon fa-chart-bar" href="#"><span>註冊</span></a>
            <ul>
              <li><a href="teacher_register.html">老師會員註冊</a></li>
              <li><a href="parent_register.html">家長會員註冊</a></li>
            </ul>
          </li>
          <li>
            <a href="#" class="icon solid fa-retweet"><span>登入</span></a>
            <ul>
              <li><a href="teacher_login.html">老師會員登入</a></li>
              <li><a href="parent_login.html">家長會員登入</a></li>
            </ul>
          </li>
          <li>
            <a id="memberCenterHref" href="#" class="icon solid fa-cog"><span>會員中心</span></a>
            <ul>
              <li><a href="teacher_interview.html">老師面試管理</a></li>
              <li><a href="parent_interview.html">家長面試管理</a></li>
            </ul>
          </li>
          <li><a class="icon solid fa-sitemap" href="#"><span>管理者中心</span></a>
            <ul>
              <li><a href="manager_login.html">管理者登入</a></li>
              <li><a href="show_members.html">檢視會員清單</a></li>
              <li><a href="show_managers.html">檢視管理者清單</a></li>
            </ul>
          </li>
        </ul>
      </nav>
      <!-- 顯示登入者姓名 -->
      <div id="parent_name" align="right">
        <label></label>
      </div>
    </div>
  </section>

  <!-- Main -->
  <section id="main">
    <div class="container">
      <div id="content">

        <!-- Post -->
        <article class="box post">
          <header>
            <h2><strong>家長會員註冊</strong> </h2>
            <h3>請輸入您的個人資料</h3>
          </header>

          <div id="flashMessage" class="message" style="display: none;"></div>


          <div class="col-6 col-12-medium">
            <section id="features">
              <form accept-charset="UTF-8" >
                <div><input type="hidden" name="_method" value="POST"></div>
                <div class="row aln-center">
                  <div class="col-6 col-12-small" >
                    <label for="member_name" style="text-align:left;">姓名</label>
                    <input type="text" name="name" placeholder="請輸入您的姓名" maxlength="50" id="member_name" required="required">
                  </div>
                  <section></section>
                  <div class="col-6 col-12-small" >
                    <label for="member_email" style="text-align:left;">email</label>
                    <input type="email" name="email" placeholder="請輸入您的email" maxlength="50" id="member_email" required="required">
                  </div>
                  <section></section>
                  <div class="col-6 col-12-small" >
                    <label for="member_password" style="text-align:left;">密碼</label>
                    <input type="password" name="password" placeholder="長度至少8，且至少包含一個數字和英文字母！" maxlength="30" id="member_password" required="required">
                  </div>
                  <section></section>
                  <div class="col-6 col-12-small">
                    <div class="row gtr-50">
                      <div class="col-6 col-12-small">
                        <label for="member_tel">手機</label>
                        <input name="tel" placeholder="格式：09XXXXXXXX" type="text"maxlength="10" id="member_tel" required="required" placeholder="格式：09XXXXXXXX" />
                      </div>
                      <div class="col-6 col-12-small">
                        <label for="select_gender">性別</label>
                        <select id="select_gender" class="form-select-button">
                          <option value="3" disabled selected>---請選擇性別---</option>
                          <option value="1">男</option>
                          <option value="2">女</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <section></section>
                  <div class="col-12">
                    <a href="#" class="form-button-submit button icon solid fa-envelope" id="submit">註冊</a>
                  </div>
                </div>

                <section></section>
                <hr>
                <section></section>
                <h5>已有有我們的帳號?
                  <a href="parent_login.html" class="form-button-submit button icon solid fa-envelope">登入</a>
                </h5>
              </form>
            </section>
          </div>

        </article>

      </div>
    </div>
  </section>

  <!-- Footer -->
  <section id="footer">
    <div class="container" >
      <header>
        <h2>Questions or comments? <strong>Get in touch:</strong></h2>
      </header>
      <ul class="links" style="text-align: center;">
        <li class="icon solid fa-home">  國立中央大學 資訊管理學系 NCU MIS</li>
        <li class="icon solid fa-envelope icons">  SA_Group16＠g.ncu.edu.tw </li>
        <li class="icon solid fa-phone icons">  03) 422-7151 分機66500 </li>
      </ul>
    </div>
    <div id="copyright" class="container">
      <ul class="links">
        <li>&copy; 安心168家教網 since2019. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
      </ul>
    </div>
  </section>

</div>

<!-- Scripts -->
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/jquery.dropotron.min.js"></script>
<script src="assets/js/browser.min.js"></script>
<script src="assets/js/breakpoints.min.js"></script>
<script src="assets/js/util.js"></script>
<script src="assets/js/main.js"></script>


<!-- 我們自己的JS -->
		<script type="text/javascript">
			$(document).ready(function(){
				var $form = $('#submit');
				$form.click(function(){
					submit();
				});
			});

			function submit(){
				var name = $('#member_name').val();
				var email = $('#member_email').val();
				var password = $('#member_password').val();
				var tel = $('#member_tel').val();
				var e = document.getElementById("select_gender");
				var gender = e.options[e.selectedIndex].value;

				var email_rule = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/;
                var password_rule = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;
                var tel_rule=/^09[0-9]{8}$/;
              	
                //先在前端確認資料皆填了(value長度皆不為0)再送去後端
                if(name.length==0 || email.length==0 || password.length==0 || tel.length==0 || gender==3){
                	alert("所有欄位皆必填!!!");
                }
                else if (!email_rule.test(email)) {
					alert("Email格式不符！");
                }
                else if(!password_rule.test(password)) {
					alert("密碼格式不符，長度至少8，且至少包含一個數字和英文字母！");
             	}
                else if (!tel_rule.test(tel)) {
                    alert("手機號碼格式不符！");
                }
                else{
                	var data_object = {
                    		"name":name,
                    		"email":email,
                    		"password":password,
                    		"cellphone":tel,
                    		"gender":gender
                    	};
                	
                	var data_string = JSON.stringify(data_object);

                	$.ajax({
                		type: "POST",
                        url: "api/parent.do",
                        data: data_string,
                        crossDomain: true,
                        cache: false,
                        dataType: 'json',
                        timeout: 5000,
                        success: function (response) {
    						alert(response.message);	//顯示訊息
    						if(response.status == 200){	//若註冊成功，將自動登入，並轉往首頁
    							directLogin(email, password);
    							alert("你的姓名是 " + name + "\n電子郵件是 " + email + "\n密碼是" + password + "\n手機號碼是" + tel );
    						}
                        },
                        error: function () {
                        	alert("無法連線到伺服器！");
                       	}
                    });
                }//else end
			}//submit end
			
			//直接登入，跳至首頁
			function directLogin(email, password){
				// 將資料組成JSON格式
	            var data_object = {
	            	"memberType":"parent",
	                "email":email,
	                "password":password
	            };
	            // 將JSON格式轉換成字串
	            var data_string = JSON.stringify(data_object);
	            
	            // 發出POST的AJAX請求
	           	$.ajax({
	                type: "POST",
	                url: "api/login.do",
	                data: data_string,
	                crossDomain: true,
	                cache: false,
	                dataType: 'json',
	                timeout: 5000,
	                success: function (response) {
	                    if(response.status == 200){
	                    	//重導至首頁
	                    	alert("直接登入，將跳轉至首頁!");
	                    	window.location.assign("http://localhost:8090/NCU_MIS_SA_Group16/");
	                    }
	                },
	                error: function () {
	                    alert("無法連線到伺服器！");
	                }
	            
	            });
			}
		</script>

</body>
</html>