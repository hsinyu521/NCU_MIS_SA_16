<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>首頁</title>

    <link rel="stylesheet" type="text/css" href="statics/css/design_home.css">
    <script src="statics/js/jquery-3.4.1.min.js" crossorigin="anonymous"></script>

</head>


<body>

<div id="container">

    <div id="header">
        <a href="index.html"><img src="statics/img/Logo.png" alt="Italian Trulli" width="200" height="100"></a>
		<a href="manager_login.html">管理者登入</a>
		<a href="teacher_login.html">老師會員登入</a>
		<a href="parent_login.html">家長會員登入</a>
        
    </div>
    
    <div id="member_name" align="right">
    	<label></label>
    </div>

    <div id="content" >
        <!-- 			<div id="next_content"></div> -->
        <nav id=Inquire >
            <h2>進階條件查詢</h2>
            <hr/>
            <div>
                <h3>&bull;上課科目</h3>
                <nav>
                    <button id="btn1">國文</button>
                    <button id="btn2">英文</button>
                    <button id="btn3">數學</button>
                    <button id="btn4">物理</button>
                    <button id="btn5">化學</button>
                    <button id="btn6">生物</button>
                </nav>
            </div>

            <div>
                <h3>&bull;教學經驗</h3>
                <select id="select" οnfοcus="selectFocus()">
                    <option οnclick="selectClick()">無經驗</option>
                    <option οnclick="selectClick()">一年以下</option>
                    <option οnclick="selectClick()">二年以下</option>
                    <option οnclick="selectClick()">三年以下</option>
                    <option οnclick="selectClick()">四年以下</option>
                    <option οnclick="selectClick()">五年以上</option>
                </select>
            </div>
        </nav>
        <div id="case">
            <div>
                <h2>最近案件</h2>
                <hr/>
            </div>
            <table id="case_list" border="1" solid #888888>
                <thead>
                <tr>
                    <td>案件編號</td>
                    <td>聯絡人</td>
                    <td>科目</td>
                    <td>對象</td>
                    <td>上課地點</td>
                    <td>教學經驗</td>
                    <td>時薪</td>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script type="text/javascript">
	$(document).ready(function(){
		getLogin();
		
	});


	function getAllCaseData() {
    	$.ajax({
              type: "GET",
              url: "api/case.do",
              crossDomain: true,
              cache: false,
              dataType: 'json',
              timeout: 5000,
              success: function (response) {
                  if(response.status == 200){
                	  updateTable(response.response.data);
                  }
                  console.log(response);
              },
              error: function () {
                  alert("無法連線到伺服器！");
              }
        });
      }
	//搜尋
	var subjectid;
	$("#btn1").click(function(){
		subjectid="國";
		getCaseDataBySubject();
	});
	$("#btn2").click(function(){
		subjectid="英";
		getCaseDataBySubject();
	});
	$("#btn3").click(function(){
		subjectid="數";
		getCaseDataBySubject();
	});
	$("#btn4").click(function(){
		subjectid="物";
		getCaseDataBySubject();
	});
	$("#btn5").click(function(){
		subjectid="化";
		getCaseDataBySubject();
	});
	$("#btn6").click(function(){
		subjectid="生";
		getCaseDataBySubject();
	});
	
    function getCaseDataBySubject() {
			  $.ajax({
		          type: "GET",
		          url: "api/case.do",
		          data: "subject=" + subjectid,
		          crossDomain: true,
		          cache: false,
		          dataType: 'json',
		          timeout: 5000,
		          success: function (response) {
		              if(response.status == 200){
		            	  alert(subjectid);
		            	  updateTable(response.response.data);
		            	  alert("更新表單");
		              }
		          },
		          error: function () {
		              alert("無法連線到伺服器！");
		          }
		    });
		  };
	var exp;
	$("#select").change(function(){
		exp = document.getElementById("select").value;
		getCaseDataByExp();
	});
    function getCaseDataByExp() {
		  $.ajax({
	          type: "GET",
	          url: "api/case.do",
	          data: "teachExperience=" + exp,
	          crossDomain: true,
	          cache: false,
	          dataType: 'json',
	          timeout: 5000,
	          success: function (response) {
	              if(response.status == 200){
	            	  alert(exp);
	            	  updateTable(response.response.data);
	            	  alert("更新表單");
	              }
	          },
	          error: function () {
	              alert("無法連線到伺服器！");
	          }
	    });
	  };
	
	  getAllCaseData();
      
      
      function updateTable(data) {
          $("#case_list > tbody").empty();
          var table_html = '';
          $.each(data, function(index, value) {
              table_html += '<tr><td>'+ '<a href="case_detail.html?id=' + value['id'] + '">' + value['id'] + '</a></td>';
              table_html += '<td>' + value['parent_name'] + '</td>';
              table_html += '<td>' + value['subject'] + '</td>';
              table_html += '<td>' + value['grade'] + '</td>';
              table_html += '<td>' + value['teach_county'] +value['teach_region'] + '</td>';
              table_html += '<td>' + value['teach_experience'] + '</td>';
              table_html += '<td>' + value['wage'] + '</td></tr>';
              
          })
          $("#case_list > tbody").append(table_html);
      }	
	
    //看有沒有人登入
	var loginPID = 0;
	var loginTID = 0;
	var loginMID = 0;
	
	function getLogin(){
		$.ajax({
			type: "GET",
			url: "api/login.do",
			crossDomain: true,
			cache: false,
			dataType: 'json',
			timeout: 5000,
			success: function (response) {
				if(response.status == 200){
					updateLogIn(response);
				}
				else{	//沒有就顯示平常的樣子
					showInit();
				}
				console.log(response);
			},
			error: function () {
				alert("無法連線到伺服器！");
			}
		});
	}
	
	//更新顯示登入會員的地方
	function updateLogIn(response){
		$("#member_name").empty();
      	var label_html = "";
      	var name = response['response']['name'];
      	var type = response['response']['memberType'];
      	var typeStr;
      	var memberCenterHref;
      	//alert(type);
      	
      	if(type=="teacher"){
      		memberCenterHref="teacher_interview.html";
      		typeStr = "老師";
      		loginTID = response['response']['id'];
      		//alert("loginTID: "+loginTID);
      	}
      	else if (type=="parent"){
      		memberCenterHref="parent_interview.html";
      		typeStr = "家長";
      		loginPID = response['response']['id'];
      		//alert("loginPID: "+ loginPID);
      	}
      	else{
      		memberCenterHref="show_managers.html";
      		typeStr = "管理者";
      		loginMID = response['response']['id'];
      	}
      	
      	label_html += '<a href='+ memberCenterHref;
      	label_html += ' <label> '+ name +'</label></a>'+ typeStr +'，您好';
      	label_html += '<button id="logoutBtn">登出</button>';
      	$("#member_name").append(label_html);
      	var $form = $('#logoutBtn');
		$form.click(function(){
			logout();
		});
    }
	
	//登出
	function logout(){
		$.ajax({
			type: "DELETE",
			url: "api/login.do",
			cache: false,
			dataType: 'json',
			timeout: 5000,
			success: function (response) {
				//如果你們前端登入成功要新跳視窗出來就打在這
				if (response.status == 200) {
					alert(response.message);
					showInit();
					loginPID=0;
					loginTID=0;
					loginMID=0;
					//alert("pid: "+loginPID +" tid: "+ loginTID);
					//window.location.reload();	//刷新頁面
				}
			},
			error: function () {
				alert("無法連線到伺服器！");
			}
		});
	}
	
	//沒會員登入的長相
	function showInit(){
		//上面20幾行的loginOrNot不要直接打東西上去，打在這，不然有登入的人還是會先閃過那個
		$("#member_name").empty();
		var label_html = '<label>訪客您好</label>';
		$("#member_name").append(label_html);
	}
	
</script>


</body>
</html>