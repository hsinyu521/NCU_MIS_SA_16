<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="statics/css/p_interview.css">
    <script src="statics/js/jquery-3.4.1.min.js" crossorigin="anonymous"></script>
    <title>家長面試管理</title>
</head>
<body>

<div id="Header">
    <a href="index.html"><img src="statics/img/Logo.png" alt="Logo"></a>
    <h1>家長面試管理</h1>
    <label id="parent_name"></label>
</div>

<div id="Sidebar">
    <p></p>
    <div clase="list"> 家長會員中心</div>
    <div class="list">
        <ul> <!--修改名稱與連結 Chu 12/25 8:27pm-->
            <li><a href="parent_change_information.html">修改家長會員資料</a></li>
            <li><a href="add_case.html">新增案件</a></li>
            <li><a href="parent_interview.html">面試管理</a></li>
            <li><a href="edit_case.html">修改案件/管理案件狀態</a></li> 
            <li><a href="parent_match.html">成交紀錄</a></li>
        </ul>
    </div>
</div>

<div id="Body">
    <div id="flashMessage" class="message" style="display: none;"></div>

    <form>
        <select id="caseID">
            <option>請選擇案件編號</option>
        </select>
    </form>

    <h3>請選擇欲成交之老師姓名</h3>

    <table id="table">
        <thead>
        <tr>
            <th></th>
            <th>老師會員姓名</th>
            <th>老師會員手機</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
        <tr>
            <td><input type="radio" name="teacher" value="id_2"></td>
            <td>以上皆不適任</td>
            <td></td>
        </tr>

    </table>

    <div class="submit"><input type="button" value="送出" id="submit"></div>

</div>

<div style='clear:both;'></div>

<div id="Footer">®安心168家教網 created by 2019</div>

<script type="text/javascript">
    // 全域變數紀錄SQL指令下的次數
    var sql_num = 0;

    function getAllMember() {
        // 發出POST的GET請求取得所有會員列表
        $.ajax({
            type: "GET",
            url: "api/teacher.do",
            crossDomain: true,
            cache: false,
            dataType: 'json',
            timeout: 5000,
            success: function (response) {
                if(response.status == 200){
                    updateTable(response.response.data);
                    updateSQLTable(response.response);
                }
                console.log(response);
            },
            error: function () {
                alert("無法連線到伺服器！");
            }
        });
    }

    // 更新會員列表表格
    function updateTable(data) {
        $("#table > tbody").empty();
        var table_html = '';
        $.each(data, function(index, value) {
            table_html += '<tr><td scope="row">' + '<input type="radio" name="teacher" value="'+value['id']+'">' + '</td>';
            table_html += '<td>' + value['name'] + '</td>';
            table_html += '<td>' + value['cellphone'] + '</td>';
        })

        $("#table > tbody").append(table_html);
    }

    // 更新SQL指令歷史表格
    function updateSQLTable(data) {
        $("#sql_log > tbody").empty();
        var time = (data.time / 1000000).toFixed(2);
        var table_html = "";

        sql_num = 0;
        sql_num += 1

        table_html += '<tr>';
        table_html += '<td>' + sql_num + '</td>';
        table_html += '<td>' + data.sql + '</td>';
        table_html += '<td style="text-align: right">' + '0' + '</td>';
        table_html += '<td style="text-align: right">' + data.row + '</td>';
        table_html += '<td style="text-align: right">' + data.row + '</td>';
        table_html += '<td style="text-align: right">' + time + '</td>';
        table_html += '</tr>';
        $("#sql_log > tbody").append(table_html);
        $("#sql_summary").html("(default) " + data.row + " queries took " + time + " ms");
    }
    $(document).ready(function() {
        getAllMember();

        var $submit = $('#submit');
        $submit.click(function(){
            alert('你確定要選擇該名老師嗎？');
        });
        
        //看登入
        checkPLogIn();
    });
    
    
	//預設都是0，如果有人登入會去改，若其他部分又去取東西再用這個
    var loginPID=0;
    var loginEmail;
    
	//看有沒有家長會員登入
	function checkPLogIn(){
		// 將資料組成JSON格式
		var data_object = {
			'option':"login"
		};
		// 將JSON格式轉換成字串
		var data_string = JSON.stringify(data_object);
          
		$.ajax({
			type: "GET",
			url: "api/parent.do",
			crossDomain: true,
			data: "option=login",
			cache: false,
			dataType: 'json',
			timeout: 5000,
			success: function (response) {
				if(response.status == 200){
					updateLogIn(response);
					loginPID = response['response']['data'][0]['id'];
					loginEmail = response['response']['data'][0]['email'];
					//alert("loginPID: "+loginPID);
					//alert("loginEmail: "+loginEmail);
					updateLogIn(response);
				}
				else{	//沒登入
					//可能跳出這個頁面
					alert("you has not logged in!");
				}
				console.log(response);
			},
			error: function () {
				alert("無法連線到伺服器！");
			}
		});
	}
	
	//沒會員登入的長相
	function showInit(){
		//上面20幾行的parent_name不要直接打東西上去，打在這，不然有登入的人還是會先閃過那個
		$("#loginOrNot").empty();
		var label_html = '<label> No login member </label>';
		$("#parent_name").append(label_html);
	}
	
	
	//更新顯示登入會員的地方
	function updateLogIn(response){
		$("#parent_name").empty();
      	var label_html = "";
      	var name = response['response']['data'][0]['name'];
      	label_html += '<label> '+ name + '家長，您好 </label>';
      	label_html += '<button id="logoutBtn">登出 </button>';
      	$("#parent_name").append(label_html);
      	var $form = $('#logoutBtn');
		$form.click(function(){
			logout();
		});
    }
	
	//登出
	function logout(){
		var urlstr = "api/parent.do";
		
		// 將資料組成JSON格式
		var data_object = {
			'email': loginEmail,
			'option':"logout"
		};
		// 將JSON格式轉換成字串
		var data_string = JSON.stringify(data_object);
		//alert("urlstr: "+urlstr);
		
		$.ajax({
			type: "PUT",
			url: urlstr,
			data: data_string,
			cache: false,
			dataType: 'json',
			timeout: 5000,
			success: function (response) {
				//如果你們前端登入成功要新跳視窗出來就打在這
				if (response.status == 200) {
					alert(response.message);
					loginPID=0;
					//showInit();
					window.location.reload();	//刷新頁面
				}
			},
			error: function () {
				alert("無法連線到伺服器！");
			}
		});
	}
</script>


</body>
</html>